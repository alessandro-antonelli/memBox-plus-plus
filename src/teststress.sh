#!/bin/bash

for ((i=0;i<16;++i)); do 

    # si fa lo spawn di un certo numero di processi ognuno che esegue una sequenza di operazioni con differente velocita'
    ./client -l $1 -s 10  -c $(($i+10)):0:1024 -c $(($i+10)):1:1024 -c $(($i+10)):2:0 -c $(($i+10)):1:1024 -c $(($i+10)):3:0 -c $(($i+10)):0:1345678 -c $(($i+10)):2:0 -c $(($i+10)):1:1345678 -c $(($i+10)):3:0 -c $(($i+10)):3:0 &
    ./client -l $1 -s 300 -c $(($i+110)):0:10240 -c $(($i+110)):1:10240 -c $(($i+110)):2:0 -c $(($i+110)):1:10240 -c $(($i+110)):3:0 -c $(($i+110)):0:134 -c $(($i+110)):2:0 -c $(($i+110)):1:134 -c $(($i+110)):3:0 -c $(($i+110)):3:0 &
    ./client -l $1 -s 600 -c $(($i+220)):0:1048576 -c $(($i+220)):1:1048576 -c $(($i+220)):2:0 -c $(($i+220)):1:1048576 -c $(($i+220)):3:0 -c $(($i+220)):0:11111 -c $(($i+220)):2:0 -c $(($i+220)):1:11111 -c $(($i+220)):3:0 -c $(($i+220)):3:0 &
    ./client -l $1 -s 100 -c $(($i+330)):0:8192 -c $(($i+330)):1:8192 -c $(($i+330)):2:0 -c $(($i+330)):1:8192 -c $(($i+330)):3:0 -c $(($i+330)):0:1221 -c $(($i+330)):2:0 -c $(($i+330)):1:1221 -c $(($i+330)):3:0 -c $(($i+330)):3:0 &
    ./client -l $1 -s 200 -c $(($i+440)):0:10240 -c $(($i+440)):1:10240 -c $(($i+440)):2:0 -c $(($i+440)):1:10240 -c $(($i+440)):3:0 -c $(($i+440)):0:134 -c $(($i+440)):2:0 -c $(($i+440)):1:134 -c $(($i+440)):3:0 -c $(($i+440)):3:0 &
    ./client -l $1 -s 700 -c $(($i+550)):0:1048576 -c $(($i+550)):1:1048576 -c $(($i+550)):2:0 -c $(($i+550)):1:1048576 -c $(($i+550)):3:0 -c $(($i+550)):0:11111 -c $(($i+550)):2:0 -c $(($i+550)):1:11111 -c $(($i+550)):3:0 -c $(($i+550)):3:0 &
    ./client -l $1 -s  50 -c $(($i+660)):0:18192 -c $(($i+660)):1:18192 -c $(($i+660)):2:0 -c $(($i+660)):1:18192 -c $(($i+660)):3:0 -c $(($i+660)):0:1221 -c $(($i+660)):2:0 -c $(($i+660)):1:1221 -c $(($i+660)):3:0 -c $(($i+660)):3:0 &
    ./client -l $1 -s 10  -c $(($i+780)):0:81920 -c $(($i+780)):1:81920 -c $(($i+780)):2:0 -c $(($i+780)):1:81920 -c $(($i+780)):3:0 -c $(($i+780)):0:1221 -c $(($i+780)):2:0 -c $(($i+780)):1:1221 -c $(($i+780)):3:0 -c $(($i+780)):3:0 &
    ./client -l $1 -s 10  -c $(($i+890)):0:98765 -c $(($i+890)):1:98765 -c $(($i+890)):2:0 -c $(($i+890)):1:98765 -c $(($i+890)):3:0 -c $(($i+890)):0:4221 -c $(($i+890)):2:0 -c $(($i+890)):1:4221 -c $(($i+890)):3:0 -c $(($i+890)):3:0 &
    ./client -l $1 -s 800  -c $(($i+1000)):0:987654 -c $(($i+1000)):1:987654 -c $(($i+1000)):2:0 -c $(($i+1000)):1:987654 -c $(($i+1000)):3:0 -c $(($i+1000)):0:14221 -c $(($i+1000)):2:0 -c $(($i+1000)):1:14221 -c $(($i+1000)):3:0 -c $(($i+1000)):3:0 &


    # questi comandi falliscono tutti
    for((k=0;k<10;++k)); do 
	./client -l $1 -c $k:3:2048
	# statistiche 
	killall -USR1 membox
    done    
    
    # statistiche 
    killall -USR1 membox

    # lock/unlock
    ./client -l $1 -s 10 -c 0:4:0 -c 2000:0:10485760 -c 2000:2:0 -c 2000:3:0 -c 0:5:0

    # statistiche 
    killall -USR1 membox

    # sequenza di put get remove
    for((k=0;k<64;++k)); do 
	./client -l $1 -c $((10000+$i+$k)):0:2048 -c $((10000+$i+$k)):2:0 -c $((10000+$i+$k)):3:0
	#statistiche 
	killall -USR1 membox
    done    

    # molte put
    for((k=0;k<1024;++k)); do 
	./client -l $1 -c $((10000+$i+$k)):0:$((128+$k))
    done
    #statistiche 
    killall -USR1 membox

    # rimozione degli oggetti
    for((k=0;k<1024;++k)); do 
	./client -l $1 -c $((10000+$i+$k)):3:0
    done
    #statistiche 
    killall -USR1 membox

    # altra sequenza di put get remove
    for((k=0;k<64;++k)); do 
	./client -l $1 -c $((20000+$i+$k)):0:$((512+$k)) -c $((20000+$i+$k)):2:0 -c $((20000+$i+$k)):3:0
    done    
    
    #statistiche 
    killall -USR1 membox

    # lock/unlock
    ./client -l $1 -s 10 -c 0:4:0 -c 2000:0:10485760 -c 2000:2:0 -c 2000:3:0 -c 0:5:0

    wait
    
    #statistiche 
    killall -USR1 membox
done



